@page
@model FitraLife.Pages.Profile.IndexModel
@{
    ViewData["Title"] = "Your Profile";
}

<div class="container py-5 profile-page">

    <!-- =================== HEADER SUMMARY CARD =================== -->
    <div class="card mb-5 border-0 shadow-sm rounded-4 profile-header">
        <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-center p-4">
            <div class="d-flex align-items-center gap-3">
                <div class="profile-avatar bg-white shadow-sm">
                    <span class="avatar-initial">@User.Identity.Name?.Substring(0,1).ToUpper()</span>
                </div>
                <div>
                    <h3 class="fw-bold mb-1">@User.Identity.Name</h3>
                    <p class="mb-0 text-muted">Fitness Level: <strong class="text-body">@(Model.Input?.ActivityLevel ?? "‚Äî")</strong></p>
                </div>
            </div>

            <div class="profile-badges text-end mt-3 mt-md-0">
                @if (Model.HasProfileComplete)
                {
                    <span class="badge bg-success me-1">‚úÖ Profile Complete</span>
                }
                @if (Model.HasActiveGoal)
                {
                    <span class="badge bg-info text-dark me-1">üî• Active Goal Set</span>
                }
                @if (Model.HasBMIRecorded)
                {
                    <span class="badge bg-warning text-dark me-1">‚öñÔ∏è BMI Recorded</span>
                }

                <span class="badge bg-secondary">Progress: @Model.ProfileCompleteness% </span>
            </div>

            <div class="text-end mt-3 mt-md-0 profile-stats">
                <h4 class="mb-1">BMI: <span class="fw-bold">@((Model.Input?.BMI ?? 0).ToString("0.0"))</span></h4>
                @if (Model.Input?.BMI != null)
                {
                    var bmi = Model.Input?.BMI ?? 0.0;
                    string bmiCategory = bmi < 18.5 ? "Underweight" :
                                         bmi < 25 ? "Normal" :
                                         bmi < 30 ? "Overweight" :
                                         "Obese";
                    <p class="mb-0 text-muted">@bmiCategory</p>
                }
            </div>
        </div>
    </div>

    <h2 class="text-center mb-4 fw-semibold">Your Fitness Profile</h2>

    @if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-success text-center shadow-sm rounded-3">@Model.StatusMessage</div>
    }

    <form method="post" class="card shadow-lg border-0 p-4 rounded-4 bg-light">
        <div class="row g-4">

            <!-- =================== PERSONAL INFO =================== -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h4 class="fw-semibold mb-3 text-primary text-center">Personal Information</h4>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Age</label>
                            <input asp-for="Input.Age" class="form-control rounded-3" type="number" min="0" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Gender</label>
                            <select asp-for="Input.Gender" class="form-select rounded-3">
                                <option>Male</option>
                                <option>Female</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Height (cm)</label>
                            <input asp-for="Input.Height" class="form-control rounded-3" type="number" step="0.1" />
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Weight (kg)</label>
                            <input asp-for="Input.Weight" class="form-control rounded-3" type="number" step="0.1" />
                        </div>

                        <div class="mb-4">
                            <label class="form-label fw-semibold">Activity Level</label>
                            <select asp-for="Input.ActivityLevel" class="form-select rounded-3">
                                <option value="Sedentary">Sedentary</option>
                                <option value="Light">Light</option>
                                <option value="Moderate">Moderate</option>
                                <option value="Active">Active</option>
                            </select>
                        </div>

                        <div class="p-3 bg-white rounded-3 border shadow-sm">
                            <h5 class="fw-bold mb-1">Current BMI</h5>
                            <h2 class="text-success mb-0">
                                @(Model.Input?.BMI.ToString("0.0") ?? "‚Äî")
                            </h2>

                            @if (Model.Input?.BMI != null)
                            {
                                var bmi = Model.Input?.BMI ?? 0.0;
                                string bmiCategory = bmi < 18.5 ? "Underweight" :
                                                     bmi < 25 ? "Normal" :
                                                     bmi < 30 ? "Overweight" :
                                                     "Obese";

                                <p class="text-muted mt-1">Category: <strong>@bmiCategory</strong></p>

                                <div class="progress bmi-progress" style="height: 10px;">
                                    <div class="progress-bar
                                        @(bmi < 18.5 ? "bg-info" :
                                          bmi < 25 ? "bg-success" :
                                          bmi < 30 ? "bg-warning" : "bg-danger")"
                                        role="progressbar"
                                        style="width:@(Math.Min(bmi / 40 * 100, 100))%">
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <!-- =================== FITNESS GOALS =================== -->
            <div class="col-lg-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h4 class="fw-semibold mb-3 text-success text-center">Fitness Goals</h4>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Goal Type</label>
                            <select asp-for="Input.GoalType" class="form-select rounded-3">
                                <option value="Maintain">Maintain</option>
                                <option value="Lose">Lose Weight</option>
                                <option value="Gain">Gain Muscle</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-semibold">Your Fitness Goal</label>
                            <textarea asp-for="Input.FitnessGoal" class="form-control rounded-3" rows="3" placeholder="E.g., Lose 5kg in 3 months, improve stamina..."></textarea>
                        </div>

                        <hr class="my-4">

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Weekly Step Goal</label>
                                <input asp-for="Input.StepGoal" class="form-control rounded-3" type="number" min="0" placeholder="e.g. 70000" />
                                <div class="small text-muted mt-1">Target weekly steps ‚Äî used across the dashboard.</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Weekly Workout Minutes Goal</label>
                                <input asp-for="Input.WorkoutMinutesGoal" class="form-control rounded-3" type="number" min="0" placeholder="e.g. 300" />
                                <div class="small text-muted mt-1">Total planned workout minutes per week.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm rounded-pill">üíæ Save Changes</button>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Animate BMI bar
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".bmi-progress .progress-bar").forEach(bar => {
                const width = bar.style.width;
                bar.style.width = "0";
                setTimeout(() => { bar.style.width = width; }, 300);
            });
        });
    </script>
}
